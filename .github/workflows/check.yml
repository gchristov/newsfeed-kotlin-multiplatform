name: check

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

env:
  GUARDIAN_API_KEY: ${{ secrets.GUARDIAN_API_KEY }}
  GUARDIAN_API_URL: ${{ secrets.GUARDIAN_API_URL }}

jobs:
  check-unit-test:
    runs-on: ubuntu-20.04
    concurrency:
      group: ${{ github.ref }}-check-unit-test
      cancel-in-progress: true
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Test
        uses: ./.github/actions/unit-test

  ios-check-build:
    runs-on: macos-15
    concurrency:
      group: ${{ github.ref }}-ios-check-build
      cancel-in-progress: true
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Build iOS
        uses: ./.github/actions/build-ios

  ios-check-test:
    runs-on: macos-15
    concurrency:
      group: ${{ github.ref }}-ios-check-test
      cancel-in-progress: true
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Test iOS
        uses: ./.github/actions/test-ios

  android-check-build:
    runs-on: ubuntu-20.04
    concurrency:
      group: ${{ github.ref }}-android-check-build
      cancel-in-progress: true
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Build Android
        uses: ./.github/actions/build-android

  android-check-test:
    runs-on: ubuntu-20.04
    concurrency:
      group: ${{ github.ref }}-android-check-test
      cancel-in-progress: true
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Test Android
        uses: ./.github/actions/test-android